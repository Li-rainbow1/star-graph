# AI智绘平台 - 项目简历

## 项目名称：AI智绘平台

**项目时间：** 2024-XX-2025-XX

**技术栈：** Spring Boot、MyBatis-Plus、MySQL、Redis、WebSocket、Retrofit、Freemarker、Redisson、ComfyUI、Ollama

---

## 项目描述

AI智绘是一个AI图像生成平台，用户输入中文描述即可生成高质量图片。集成Ollama翻译和ComfyUI生图，支持任务队列管理、实时进度推送、积分系统等功能。

---

## 核心技术

### 1. AI服务集成与工作流动态生成

使用 Retrofit 调用 Ollama 翻译中文提示词，通过 FreeMarker 模板动态生成 ComfyUI 工作流 JSON，实现参数配置解耦。

### 2. Redis ZSet 分布式优先级队列设计

基于 Redis ZSet 实现分布式优先级队列，通过 incr 生成分布式自增 ID 作为 score 保证 FIFO，使用 ZPOPMIN 原子弹出任务，支持任务动态插队和取消。

### 3. 定时任务调度与并发流量控制

使用 Spring Task 定时扫描队列提交任务，结合 Redisson 分布式锁防止集群重复消费，通过信号量限制并发数防止 ComfyUI 过载，任务完成/失败时释放信号量避免泄露。

### 4. WebSocket 双向通信架构

采用 WebSocket 双向通信：作为客户端连接 ComfyUI 接收任务状态，作为服务端基于 STOMP 协议向前端推送任务进度和结果。



### 6. Redis 分布式锁与 Lua 脚本原子化操作

基于 Redis SETNX 实现分布式锁，用于任务取消和插队的并发控制。通过 Lua 脚本原子化解锁（GET + DEL），防止误删其他线程的锁。

---

## 技术架构图

```text
┌─────────────────────────────────────────────────────┐
│                    前端（Vue3）                      │
│  - WebSocket客户端（接收实时推送）                   │
│  - HTTP请求（提交任务、查询结果）                     │
└────────────────┬────────────────────────────────────┘
                 │ WebSocket + HTTP
                 │
┌────────────────▼────────────────────────────────────┐
│            Spring Boot 后端（核心层）                │
│                                                      │
│  ┌─────────────┐  ┌──────────────┐  ┌───────────┐ │
│  │ Controller  │  │  WebSocket   │  │  定时任务  │ │
│  │             │  │  服务端      │  │  (调度器)  │ │
│  └──────┬──────┘  └──────┬───────┘  └─────┬─────┘ │
│         │                │                  │       │
│  ┌──────▼────────────────▼──────────────────▼────┐ │
│  │              Service业务层                     │ │
│  │  - 任务管理  - 积分管理  - 消息推送             │ │
│  └──────┬───────────────┬──────────────┬─────────┘ │
│         │               │              │           │
│  ┌──────▼──────┐  ┌────▼──────┐  ┌───▼─────────┐ │
│  │  Mapper层   │  │WebSocket  │  │  Retrofit   │ │
│  │  (数据库)   │  │  客户端   │  │  (HTTP客户端)│ │
│  └──────┬──────┘  └────┬──────┘  └───┬─────────┘ │
└─────────┼──────────────┼──────────────┼───────────┘
          │              │              │
    ┌─────▼────┐   ┌────▼─────┐   ┌───▼────────┐
    │  MySQL   │   │  Redis   │   │  ComfyUI   │
    │          │   │  - ZSet  │   │  (AI引擎)  │
    │  - 用户  │   │  - Lock  │   │            │
    │  - 积分  │   │  -Semaph.│   └─────┬──────┘
    │  - 结果  │   └──────────┘         │
    └──────────┘                  ┌─────▼──────┐
                                  │  Ollama    │
                                  │  (翻译AI)  │
                                  └────────────┘
```

---

## 项目亮点总结

- ✅ **AI工作流动态生成**：Freemarker模板 + Retrofit调用，参数配置灵活
- ✅ **优先级队列与插队**：Redis ZSet实现，VIP动态调整优先级
- ✅ **并发控制**：Redisson信号量限制并发数，防止GPU过载
- ✅ **实时双向通信**：WebSocket监听ComfyUI + STOMP推送前端
- ✅ **分布式锁设计**：手动实现Redis SETNX锁 + Lua脚本原子解锁，防误删锁
- ✅ **乐观锁并发控制**：版本号机制防止并发更新冲突，事务保证原子性

---

## 适用场景

本简历内容适用于：

- Java后端开发岗位
- 分布式系统开发岗位
- AI应用开发岗位
- 全栈开发岗位

**建议根据实际项目时间和个人贡献调整内容。**
